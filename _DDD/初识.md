## 1.1 领域驱动设计概览

### 什么是领域驱动设计

- 将要解决的业务概念和业务规则转换为软件系统中的类型以及类型的属性与行为，通过合理运用面向对象的封装、继承和多态等设计要素。降低或隐藏整个系统的业务复杂性，并使得系统具有更好的扩展性，应对纷繁多变的现实业务问题
- 领域驱动设计不是架构方法，也并非设计模式。准确地说，它其实是“一种思维方式，也是一组优先任务，它旨在加速那些必须处理复杂领域的软件项目的开发
- 领域驱动设计强调领域模型的重要性，并通过模型驱动设计来保障领域模型与程序设计的一致。从业务需求中提炼出统一语言（Ubiquitous Language），再基于统一语言建立领域模型。领域模型指导设计与编码。通过重构来发现隐式概念，并运用设计模式改进设计与开发质量

### 领域驱动设计的特点

- 领域驱动设计贯穿了整个软件开发的生命周期，包括对需求的分析、建模、架构、设计，甚至最终的编码实现，乃至对编码的测试与重构

### 领域驱动层级划分

> 领域驱动可能会面临高复杂度的挑战。在为问题域寻求解决方案时，需要从宏观层次划分不同业务关注点的子领域，然后再深入到子领域中从微观层次对领域进行建模。
>
> 宏观层次是战略的层面，微观层次是战术的层面

#### 战略设计

- **问题域方面**：针对问题域，引入**限界上下文（Bounded Context）**和**上下文映射（Context Map）**对问题域进行合理的分解，识别出**核心领域（Core Domain）**与**子领域（SubDomain）**，并确定领域的边界以及它们之间的关系，维持模型的完整性
- **架构方面**：通过**分层架构**来隔离关注点，尤其是将领域实现独立出来，能够更利于领域模型的单一性与稳定性；引入**六边形架构**可以清晰地表达领域与技术基础设施的边界；CQRS 模式则分离了查询场景和命令场景，针对不同场景选择使用同步或异步操作，来提高架构的低延迟性与高并发能力

#### 战术设计

在战术层面，它主要应对的是领域的复杂性。领域驱动设计用以表示模型的主要要素包括：

- 值对象（Value Object）
- 实体（Entity）
- 领域服务（Domain Service）
- 领域事件（Domain Event）
- 资源库（Repository）
- 工厂（Factory）
- 聚合（Aggregate）
- 应用服务（Application Service）

战术设计诸要素之间的关系：

![img](..\images\999999\41040a90-7854-11e8-9ada-255ab1257678)

- 领域驱动设计围绕着领域模型进行设计，通过**分层架构（Layered Architecture）**将领域独立出来。表示领域模型的对象包括：**实体**、**值对象**和**领域服务**，**领域逻辑都应该封装在这些对象中**。在领域驱动设计的演进中，又引入了**领域事件**来丰富领域模型。
- **聚合**是一种边界，它可以封装一到多个**实体**与**值对象**，并维持该边界范围之内的业务完整性。在聚合中，至少包含一个实体，且只有实体才能作为**聚合根（Aggregate Root）**。聚合代表的是边界概念，而非领域概念。
- **工厂**和**资源库**都是对领域对象生命周期的管理。前者负责领域对象的创建，往往用于封装复杂或者可能变化的创建逻辑；后者则负责从存放资源的位置（数据库、内存或者其他 Web 资源）获取、添加、删除或者修改领域对象。领域模型中的资源库不应该暴露访问领域对象的技术实现细节

## 1.2 深入分析软件的复杂度

### 复杂度成因

- 没有对行为的重用，也没有对业务问题的抽象，每当操作用到业务规则时，都要重复这些业务规则
- 快速的原型建立和迭代很快会达到其极限，因为抽象的缺乏限制了重构的选择
- 复杂的功能很快会让你无所适从，所以程序的扩展只能是增加简单的应用模块，没有很好的办法来实现更丰富的功能

### 什么是复杂

- 由大量相互作用的部分组成的系统，与整个系统比起来，这些组成部分相对简单，没有中央控制，组成部分之间也没有全局性的通讯，并且组成部分的相互作用导致了复杂行为。软件设计中组成部分所谓的“设计单元”，基于粒度的不同可以是函数、对象、模块、组件和服务。这些设计单元相对简单，然而彼此之间的相互作用却导致了软件系统的复杂行为。

> 要理解软件复杂度的成因，就应该结合**理解力**与**预测能力**这两个因素来帮助我们思考。

### 理解力

#### 一、影响理解力要素：**规模**

- 软件的需求决定了系统的规模。当需求呈现线性增长的趋势时，软件规模也会以近似的速度增长。而且需求不可能做到完全独立，会大量出现相互影响相互依赖的关系

#### 二、影响理解力要素：**结构**

- 系统的质量属性决定着结构的复杂性。为了提高系统的质量就要增加结构的复杂程度，比如：引入cache、拆分微服务架构等

### 预测能力

- 变化可能来自业务需求，也可能来自质量属性或者依赖的第三方系统和工具。变化影响着预测能力

